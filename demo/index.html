<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Demo</title>
    <link rel="stylesheet" href="/demo/assets/css/grid.css">
    <link rel="stylesheet" href="/demo/assets/css/index.css">
    <script src="/dist/na.bundle.js"></script>
</head>
<body>
<div class="table height-100">
    <div id="menu" class="width-20 valign-top"></div>
    <div id="app" class="valign-top"></div>
</div>
<script>
    const {
        Util,
        Dom,
        Roxy,
    } = NamespaceApplication;

    // const TEST_SCRIPT = '/demo/tasks/index.js';
    // if (TEST_SCRIPT) {
    //     Util.loadJS(TEST_SCRIPT);
    // }

    let srcs = [];
    const menuElement = Dom('#menu');
    const appElement = Dom('#app');

    Util.httpRequest({url: '/demo/menu.json'}, function (status, responseText) {
        if (status === 200) {
            const menuItems = JSON.parse(responseText);
            Object.keys(menuItems).forEach((key) => {
                if (['__', 'redirect'].indexOf(key) === -1)
                    menuElement.append('<span class="menu-item" data-key="'+ (menuItems[key]) +'">'+key+'</span>');

                if (key === 'redirect') {
                    Object.keys(menuItems[key]).forEach((keyRedirect) => {
                        menuElement.append('<span class="menu-item" data-key="redirect.'+ (menuItems[key][keyRedirect]) +'">'+keyRedirect+'</span>');
                    });

                }
            });

            menuElement.on('click', (eve) => {
                const src = Dom(eve.target).attr('data-key');
                if (src.indexOf('redirect.') === 0)
                    location.href = '/demo/' + src.substring(9);
                else
                    appLoader(src)
            });
        }
    });

    function appLoader(src) {
        if (srcs) {
            srcs.forEach((src) => src.parentNode.removeChild(src));
            appElement.inject('');
        }

        const appLoader = new NamespaceApplication({});
        appLoader.dependency({
            js: [
                '/demo' + src,
            ],
            complete: (list) => {
                srcs = list.elements;
            }
        })
    }

</script>
</body>
</html>